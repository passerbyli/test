<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>X6 æ’ä»¶åŠŸèƒ½æµ‹è¯•</title>
    <style>
      #container {
        width: 100%;
        height: 600px;
        border: 1px solid #ccc;
      }
      .html-code {
        white-space: pre-wrap; /* âœ… ä¿ç•™æ¢è¡Œä¸ç¼©è¿› */
        word-break: break-word; /* âœ… é˜²æ­¢è¶…é•¿å†…å®¹ä¸æ¢è¡Œ */
        font-family: Consolas, monospace;
        font-size: 14px;
        background: #f8f8f8;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow-x: auto;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@antv/x6/dist/index.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-dax.min.js"></script>
  </head>
  <body>
    <h2>ğŸ§ª X6 æ’ä»¶åŠŸèƒ½éªŒè¯é¡µé¢</h2>
    <div id="container"></div>

    <div>
      <span class="btn-icon btn-copy" data-text="SUMX(GROUPBY(
  FILTER('é”€é‡è¡¨', IF(ISFILTERED('é—¨åº—è¡¨'[é—¨åº—å]), 'é”€é‡è¡¨'[é”€å”®é—¨åº—] IN VALUES('é—¨åº—è¡¨'[é—¨åº—å]), TRUE())),
  'é”€é‡è¡¨'[äº§å“ç¼–ç ],
  "SUM", SUMX(CURRENTGROUP(), 'é”€é‡è¡¨'[é”€å”®é‡])
), [SUM])">ğŸ“‹</span>
      <pre class="html-code"><code>SUMX(GROUPBY(
  FILTER('é”€é‡è¡¨', IF(ISFILTERED('é—¨åº—è¡¨'[é—¨åº—å]), 'é”€é‡è¡¨'[é”€å”®é—¨åº—] IN VALUES('é—¨åº—è¡¨'[é—¨åº—å]), TRUE())),
  'é”€é‡è¡¨'[äº§å“ç¼–ç ],
  "SUM", SUMX(CURRENTGROUP(), 'é”€é‡è¡¨'[é”€å”®é‡])
), [SUM])</code></pre>
    </div>
    <script>
      // è½¬ä¹‰å‡½æ•°ï¼ˆç”¨äºå±•ç¤ºï¼‰
      function escapeHTML(str) {
        return str
          .replace(/&/g, '&amp;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
      }

      // // æ˜¾ç¤ºè½¬ä¹‰ç‰ˆæœ¬
      // const codeEl = document.querySelector('.html-code code')

      // // è®¾ç½® data-text
      // const btn = document.querySelector('.btn-copy')
      // codeEl.innerText = daxCode // innerText é¿å…ä»£ç è¢«è§£æ
      // btn.dataset.text = daxCode

      // codeEl.innerText =htmlStr;  // innerText é¿å…ä»£ç è¢«è§£æ
      // btn.dataset.text = htmlStr;

      const daxCode = `SUMX(GROUPBY(
  FILTER('é”€é‡è¡¨', IF(ISFILTERED('é—¨åº—è¡¨'[é—¨åº—å]), 'é”€é‡è¡¨'[é”€å”®é—¨åº—] IN VALUES('é—¨åº—è¡¨'[é—¨åº—å]), TRUE())),
  'é”€é‡è¡¨'[äº§å“ç¼–ç ],
  "SUM", SUMX(CURRENTGROUP(), 'é”€é‡è¡¨'[é”€å”®é‡])
), [SUM])`

      const htmlStr = `<div class="box">Hello & Welcome</div>`
      // âœ… æ­£ç¡®æ’å…¥æ˜¾ç¤ºå†…å®¹
      document.querySelector('.html-code code').innerText = daxCode

      // âœ… è®¾ç½®å¤åˆ¶ç”¨çš„åŸå§‹å€¼
      document.querySelector('.btn-copy').addEventListener('click', () => {
        navigator.clipboard.writeText(daxCode).then(() => {
          alert('å¤åˆ¶æˆåŠŸ')
        })
      })

      const { Graph } = window.X6

      const graph = new Graph({
        container: document.getElementById('container'),
        grid: true,
        panning: true,
        selecting: true,
      })

      // æ·»åŠ åˆå§‹èŠ‚ç‚¹
      const node1 = graph.addNode({
        id: 'node1',
        x: 100,
        y: 100,
        width: 120,
        height: 40,
        label: 'èŠ‚ç‚¹ 1',
        attrs: {
          body: {
            'data-node-id': 'node1', // è®¾ç½®è‡ªå®šä¹‰å±æ€§
            stroke: '#5F95FF',
            fill: '#EFF4FF',
          },
        },
      })

      const node2 = graph.addNode({
        id: 'node2',
        x: 300,
        y: 200,
        width: 120,
        height: 40,
        label: 'èŠ‚ç‚¹ 2',
        attrs: {
          body: {
            'data-node-id': 'node2', // è®¾ç½®è‡ªå®šä¹‰å±æ€§
            stroke: '#5F95FF',
            fill: '#EFF4FF',
          },
        },
      })

      // æ·»åŠ è¾¹
      graph.addEdge({
        source: node1,
        target: node2,
      })

      // æŠŠ graph æš´éœ²åˆ° window ä¸Šä¾›æ’ä»¶ä½¿ç”¨
      window.custom_epo_utils = graph
    </script>
  </body>
</html>

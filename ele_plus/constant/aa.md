## STRIDE+P 威胁分析矩阵（详细影响描述 + 多点措施建议）

以下为系统中每个元素和关键数据流的 STRIDE+P 威胁分类，附带：

- 威胁影响描述（≥3点）
- 已有消减措施（≥3项）
- 可行性分析（≥3项）
- 建议的改进措施（≥3项）
- 风险等级

---

### 元素：Authentication Service（Process）

**S - 身份伪造**

- **影响描述**：

  1. 攻击者可冒充合法用户访问系统数据。
  2. 可登录后绑定第三方账号提升权限。
  3. 越权访问系统中的个人数据或接口。

- **已有措施**：

  1. 登录使用用户名+密码+验证码三重认证。
  2. JWT Token 使用 HMAC SHA256 加签。
  3. 限制登录失败次数 + IP 黑名单策略。

- **可行性**：

  1. 已部署验证码组件（图形/滑块）可复用。
  2. 登录链路均已接入统一认证服务。
  3. Token 发放统一通过内部加密模块完成。

- **建议消减措施**：

  1. 引入 MFA（短信/邮箱/OTP）用于敏感场景再认证。
  2. Token 加入设备指纹/IP 签名防止伪造转发。
  3. 异地登录或短时切换地理位置发出风险提示。

- **风险等级**：高

**T - 数据篡改**

- **影响描述**：

  1. 登录参数如用户名被篡改，可伪造其他用户身份。
  2. 通过构造修改 Token 参数伪造认证身份。
  3. 认证响应被劫持修改为高权限用户 Token。

- **已有措施**：

  1. 全站 HTTPS 强制启用。
  2. JWT 使用对称加密签名，防篡改。
  3. 服务端验证 Token 签名与过期时间。

- **可行性**：

  1. HTTPS 由前置 Nginx 网关统一配置，无中间人。
  2. JWT 验签模块封装统一由中间件处理。
  3. 有完整 Token 生命周期配置与刷新机制。

- **建议消减措施**：

  1. 引入短有效期 Token + RefreshToken 机制，防止泄露长期有效。
  2. 所有接口参数加入签名机制（时间戳 + Nonce）。
  3. 登录/发 Token 记录加入请求指纹、IP 校验，避免伪造重放。

- **风险等级**：高

**R - 抵赖**

- **影响描述**：

  1. 用户声称未曾发起过登录。
  2. 攻击者使用共享设备登录后可推责。
  3. 日志记录不足，无法定位异常账户行为。

- **已有措施**：

  1. 登录操作记录 IP、Token、User-Agent。
  2. 所有登录行为接入日志平台 ELK 收集。
  3. 登录日志支持字段索引，可按用户追踪。

- **可行性**：

  1. 日志可按用户、设备回查 6 个月内记录。
  2. 所有 Token 发放节点已有审计钩子。
  3. 登录服务组件支持扩展上下文注入字段。

- **建议消减措施**：

  1. 在登录成功时记录并显示设备名、IP，提示用户。
  2. 引入安全日志平台，设立行为日志分析规则。
  3. 用户可手动查看/撤销历史登录记录和 Token。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 错误信息中包含用户是否存在提示（User not found vs wrong password）。
  2. 返回结构或调试模式泄露代码堆栈信息。
  3. Token 中误包含邮箱/手机号等 PII 字段。

- **已有措施**：

  1. 错误响应统一格式，无明确身份识别信息。
  2. JWT 结构中仅包含 User ID。
  3. 日志中敏感字段做脱敏处理（如掩码）。

- **可行性**：

  1. Spring 全局异常处理器支持格式控制。
  2. Token 结构由认证服务中心统一发放控制。
  3. 日志系统具备字段正则匹配脱敏插件。

- **建议消减措施**：

  1. 所有错误响应统一 200 状态码封装，避免直接暴露异常栈。
  2. 对生产环境默认关闭调试信息。
  3. 增加接口自动扫描工具检测敏感信息暴露点。

- **风险等级**：中

**D - 拒绝服务**

- **影响描述**：

  1. 登录接口被攻击者持续刷爆导致正常用户无法登录。
  2. 整站认证依赖认证服务挂掉导致所有接口不可访问。
  3. 构造大体量Token请求造成系统资源耗尽。

- **已有措施**：

  1. 登录失败 5 次锁定账户 15 分钟。
  2. IP 维度限流（QPS），每分钟最大尝试次数。
  3. Token 加密签名与验证模块已做性能优化。

- **可行性**：

  1. 认证服务部署具备集群能力可横向扩展。
  2. 网关支持 IP 限流配置动态更新。
  3. 日志与监控平台可捕捉到 DoS 攻击行为。

- **建议消减措施**：

  1. 登录接口启用行为验证码（滑块、点击图像验证）。
  2. 对于来自可疑国家/设备登录行为增加行为挑战。
  3. 接入机器学习检测暴力行为并自动封禁。

- **风险等级**：高

**E - 权限提升**

- **影响描述**：

  1. 普通用户伪造管理员角色字段。
  2. 构造请求访问仅管理员可使用的资源。
  3. 授权校验不严谨导致接口横向越权。

- **已有措施**：

  1. Token 包含 Scope 和权限声明。
  2. 接口层通过注解校验权限等级。
  3. 管理员 Token 在认证服务层独立签发，带标识。

- **可行性**：

  1. 权限模型（RBAC）已接入微服务统一认证体系。
  2. 网关可解析并判断角色/权限等级。
  3. 接口服务具备 AOP 拦截器可扩展校验逻辑。

- **建议消减措施**：

  1. 接口权限定义集中化，生成权限标识文档。
  2. 对敏感接口启用角色+资源级别多因子判断。
  3. 建立测试用例专门验证横向/纵向越权路径。

- **风险等级**：高

**P - 隐私侵犯**

- **影响描述**：

  1. Token 中包含用户手机号、邮箱等字段。
  2. 返回信息中带有注册地、设备 ID、行为轨迹等。
  3. 日志记录中暴露用户身份属性未脱敏。

- **已有措施**：

  1. Token 结构固定，仅包含 user_id，不含 PII。
  2. 错误响应中字段已脱敏（如手机号掩码）。
  3. 日志中通过正则匹配字段脱敏插件处理敏感字段。

- **可行性**：

  1. 后端服务采用统一响应结构，可集中处理输出字段。
  2. 使用框架内置日志格式化处理器。
  3. 敏感字段有标签机制，便于识别与替换。

- **建议消减措施**：

  1. 所有输出字段增加 PII 标识，交由框架统一脱敏处理。
  2. 接口返回结构中禁止传递用户真实敏感数据。
  3. 日志字段脱敏逻辑集中维护与统一配置。

- **风险等级**：中

---

### 元素：API Gateway（Process）

**T - 数据篡改**

- **影响描述**：

  1. 攻击者篡改请求参数绕过鉴权机制访问受限资源；
  2. 构造伪造Header伪装为其他用户访问其资源；
  3. 利用代理/爬虫工具修改请求内容干扰网关行为；

- **已有措施**：

  1. HTTPS 接入限制中间人修改流量内容；
  2. 网关具备参数验签机制；
  3. 通过签发 Token 校验身份并附加签名字段；

- **可行性分析**：

  1. 网关已有统一签名验签能力可覆盖接口流量；
  2. 可动态维护签名算法与时效性校验逻辑；
  3. 支持将签名校验失败行为记录入日志；

- **建议消减措施**：

  1. 引入时间戳 + Nonce 参数防止重放；
  2. 所有敏感参数统一采用签名机制传输；
  3. 验签失败统一落审计日志 + 告警。

- **风险等级**：高

**R - 抵赖**

- **影响描述**：

  1. 用户访问后声称从未调用该接口；
  2. 管理员无法溯源异常行为发生主体；
  3. 部分接口日志字段缺失，难以追责；

- **已有措施**：

  1. 接口日志记录用户 ID 与 Token；
  2. 每个请求带有 TraceId 实现全链路追踪；
  3. 日志按请求 URI、调用耗时等分类管理；

- **可行性分析**：

  1. 所有请求均接入日志框架，可添加自定义字段；
  2. 链路追踪系统（如 Skywalking）已接入；
  3. 网关具备统一日志落盘与审计传输机制；

- **建议消减措施**：

  1. 在日志中记录完整调用链与传参明细；
  2. 用户接口访问历史开放前端可见，提高透明度；
  3. 异常行为日志支持结构化查询与风险评分。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 网关异常返回堆栈信息泄露内部模块实现细节；
  2. 接口响应中包含未授权字段如角色列表；
  3. 网关重定向响应时泄露跳转地址中的Token；

- **已有措施**：

  1. 禁用默认异常输出，采用统一错误响应结构；
  2. 接口字段采用白名单策略；
  3. URI 参数中移除敏感Token字段；

- **可行性分析**：

  1. 现有异常处理拦截器已可捕获全部未处理异常；
  2. 接口结构由服务端 Schema 控制输出字段；
  3. 重定向行为均在服务端统一封装处理；

- **建议消减措施**：

  1. 网关设置默认错误响应为固定模版；
  2. 所有返回结构字段需具备权限标签控制；
  3. 日志、响应体中禁止记录 URI 中的 Token 或用户信息。

- **风险等级**：中

**D - 拒绝服务**

- **影响描述**：

  1. 恶意请求造成接口瞬时 QPS 激增拖垮网关；
  2. 复杂请求使下游服务超时并雪崩回溯；
  3. 多租户环境中一个用户行为影响全局；

- **已有措施**：

  1. IP 级限流；
  2. 单接口 QPS 限制，熔断重试机制；
  3. 网关限流组件已部署支持令牌桶模式；

- **可行性分析**：

  1. 网关已有限流插件与配置中心联动；
  2. 熔断组件支持慢启动、预热等策略；
  3. 日志中已可识别 QPS、RT、状态码等指标；

- **建议消减措施**：

  1. 按租户限流策略隔离影响范围；
  2. 引入接口打分系统对高频攻击 IP 黑名单处理；
  3. 限流失败次数过高用户触发验证码等人机验证。

- **风险等级**：高

**E - 权限提升**

- **影响描述**：

  1. 普通用户通过构造请求访问管理接口；
  2. 无鉴权接口被误开放给非授权角色；
  3. 管理员角色字段在Token中被伪造；

- **已有措施**：

  1. Token包含 Scope/Role 字段供后端解析；
  2. 接口权限注解接入权限中心；
  3. 部分关键接口做权限校验后置封装；

- **可行性分析**：

  1. 网关具备解析 Token 并转发权限字段能力；
  2. 权限平台与接口配置平台可同步校验规则；
  3. 接口注解权限可自动生成接口权限清单；

- **建议消减措施**：

  1. 所有接口绑定权限项统一注册到权限平台；
  2. 管理端接口仅开放特定白名单 IP 访问；
  3. 使用动态权限匹配机制，按访问行为实时评估。

- **风险等级**：高

**P - 隐私侵犯**

- **影响描述**：

  1. 请求日志中记录了身份证、手机号明文；
  2. 接口响应含用户行为日志、IP 地址等信息；
  3. 日志传输过程中敏感数据无加密传输；

- **已有措施**：

  1. 接口响应中常规字段已标记脱敏；
  2. 日志写入前使用正则表达式做部分掩码处理；
  3. 使用日志收集组件具备加密传输能力；

- **可行性分析**：

  1. 日志组件支持插件扩展，便于敏感字段识别处理；
  2. 接口字段结构统一，易于识别敏感字段；
  3. 日志传输链路基于 HTTPS 传输安全性高；

- **建议消减措施**：

  1. 建立字段标签体系，对敏感字段自动识别与脱敏；
  2. 统一日志脱敏规则，输出前处理而非存储时清洗；
  3. 增加访问日志的隐私评估机制和泄露检测机制。

- **风险等级**：高

---

### 元素：Microservices（Process）

**T - 数据篡改**

- **影响描述**：

  1. 用户通过修改URL参数或请求体绕过前端校验。
  2. 微服务间调用参数未验签，可能被中间人或网关污染。
  3. 关键操作（如订单审批）被恶意修改请求内容导致业务状态异常。

- **已有措施**：

  1. 大部分服务启用参数合法性校验（如 JOI、Validator）。
  2. 请求数据使用统一DTO层进行转换处理。
  3. 对关键接口接入了接口签名中间件。

- **可行性分析**：

  1. 项目已统一使用框架（如 NestJS/Spring）支持参数注解校验。
  2. 中间件支持切面拦截参数做预处理和校验。
  3. 请求结构清晰，适合统一封装验签逻辑。

- **建议消减措施**：

  1. 引入统一参数签名机制，敏感操作请求带签名字段校验。
  2. 对外部调用服务之间启用调用验签协议。
  3. 对订单、权限、配置等敏感操作启用多字段校验+幂等检查。

- **风险等级**：中

**R - 抵赖**

- **影响描述**：

  1. 用户否认某次操作，如导出数据、提交审批等；
  2. 日志中未记录请求来源、调用链、操作对象等关键信息；
  3. 审计日志缺失导致难以还原问题全貌。

- **已有措施**：

  1. 操作行为日志接入 ELK。
  2. 部分操作支持记录 IP、Token、User-Agent。
  3. 关键服务接入全链路 TraceId 打印。

- **可行性分析**：

  1. 微服务日志框架支持字段注入（如 MDC、Context）。
  2. 所有服务均支持引入 traceId 并上下文传递。
  3. 认证信息在Header中统一传递，可提取用户身份信息。

- **建议消减措施**：

  1. 审计日志结构化存储，统一记录用户行为、时间、操作对象等。
  2. 所有敏感操作（修改、导出）自动记录行为轨迹。
  3. 支持前端操作日志与后端行为日志对齐校验。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 返回结果中包含身份证、手机号、邮箱等敏感字段；
  2. 服务间调用未脱敏直接透传给前端；
  3. 报错信息中返回数据库字段或表结构信息。

- **已有措施**：

  1. 对外接口响应使用DTO白名单过滤字段；
  2. 对敏感字段添加脱敏工具类（如掩码）；
  3. 异常堆栈信息只打印不输出到前端。

- **可行性分析**：

  1. 各服务输出结构统一封装，便于字段统一拦截；
  2. 大多数敏感字段命名规范统一（如 phone, idcard）；
  3. 脱敏工具类可被中间件封装自动化处理。

- **建议消减措施**：

  1. 敏感字段打标签（@Sensitive），由框架统一处理；
  2. 所有接口默认返回结构做字段脱敏扫描；
  3. 支持返回结果对比白名单字段并自动报警。

- **风险等级**：高

**D - 拒绝服务**

- **影响描述**：

  1. 用户通过构造大分页请求或复杂查询拖垮微服务；
  2. 批量导出任务堆积造成服务线程耗尽；
  3. 无索引字段查询导致数据库压力升高影响微服务稳定性。

- **已有措施**：

  1. 分页接口限制最大页码和每页条数；
  2. 导出接口使用异步任务执行并加入限流；
  3. 所有服务启用线程池隔离。

- **可行性分析**：

  1. 网关支持接口QPS/RT监控；
  2. 微服务可接入熔断器如 Resilience4j / Sentinel；
  3. 已具备慢查询日志分析与指标监控。

- **建议消减措施**：

  1. 对查询语句接入 SQL 风险分析插件限制高危语句；
  2. 大查询操作统一使用任务池异步处理并限速出结果；
  3. 引入用户行为打分系统自动降低高风险操作频次。

- **风险等级**：高

**E - 权限提升**（含横向 / 纵向越权）

- **影响描述**：

  1. 用户修改 ID 参数访问他人数据（横向越权）；
  2. 普通用户调用管理接口获取数据或修改权限（纵向越权）；
  3. 内部接口未鉴权或仅依赖前端控制，存在访问绕过风险。

- **已有措施**：

  1. 接口使用 @PreAuthorize 或自定义注解控制访问；
  2. 租户 ID / 用户 ID 自动注入查询条件中；
  3. 管理接口统一挂载在管理路径并限制网关访问。

- **可行性分析**：

  1. 接口服务支持拦截器统一注入用户上下文字段；
  2. 网关支持权限字段透传与统一身份解析；
  3. 微服务内 RBAC / ABAC 模型已集成基础能力。

- **建议消减措施**：

  1. 接口进行资源绑定权限校验（ID与当前登录用户匹配）；
  2. 接口权限策略集中配置，支持测试用例回归覆盖越权路径；
  3. 对高权限操作启用二次确认或多因子认证机制。

- **风险等级**：高

**P - 隐私侵犯**

- **影响描述**：

  1. 接口直接返回用户手机号、身份证等原始字段；
  2. 日志记录请求/响应体时泄露隐私数据；
  3. 返回字段未过滤造成非目标用户数据泄露。

- **已有措施**：

  1. 常见字段统一使用脱敏工具处理（如手机掩码）；
  2. 接口输出字段白名单过滤输出；
  3. 日志中敏感字段脱敏（如idcard → \*\*\*）。

- **可行性分析**：

  1. 后端字段命名规范统一，适合做统一脱敏策略；
  2. 输出结构统一封装便于集中处理；
  3. 日志框架支持脱敏插件扩展。

- **建议消减措施**：

  1. 敏感字段由配置中心统一维护敏感字段列表；
  2. 引入接口返回结构检查机制，部署前做敏感字段扫描；
  3. 接入数据使用目的审计机制，防止敏感数据越界使用。

- **风险等级**：高

---

### 元素：Data Warehouse A/B/C（Data Store）

**T - 数据篡改**

- **影响描述**：

  1. 攻击者若获得写权限，可修改底层明细数据，导致业务统计异常；
  2. 误操作 SQL（如 UPDATE / DELETE）影响整批数据准确性；
  3. 内部开发人员测试脚本执行造成正式数据错写或覆盖；

- **已有措施**：

  1. 默认使用只读账号连接生产数据仓库；
  2. 数据更新必须走审批流程 + 审计记录；
  3. 使用视图或物化视图避免用户直接修改基表；

- **可行性分析**：

  1. 数据访问配置中心统一管理连接信息和账号权限；
  2. 运维平台具备数据库变更审批流；
  3. 大部分分析接口由中间表/视图提供结果输出，避免写操作；

- **建议消减措施**：

  1. 所有 DML 操作执行前必须自动生成快照备份；
  2. 只读账号按业务系统拆分，最小权限隔离；
  3. 接口层启用逻辑保护机制，禁止执行 DML 操作 SQL 请求。

- **风险等级**：中

**R - 抵赖**

- **影响描述**：

  1. 数据修改后找不到操作记录或用户，导致溯源失败；
  2. 数据导出、查询结果被用于其他目的，无法追踪来源；
  3. 用户导出的 Excel 被篡改后传播，引发争议难以澄清；

- **已有措施**：

  1. 所有导出操作记录日志（用户名/时间/参数/IP）；
  2. SQL 执行平台保留操作审计记录；
  3. 数据处理平台提供任务执行记录与日志；

- **可行性分析**：

  1. 数据使用链路清晰，查询来源可识别模块与用户；
  2. 已接入审计平台，具备审计信息采集能力；
  3. 报表系统支持用户行为留痕及溯源查询；

- **建议消减措施**：

  1. 数据使用日志与审计日志对齐，形成统一用户操作链路；
  2. 所有导出数据默认带数字水印（如查询人ID/时间戳）；
  3. 自动标记敏感数据查询记录，定期抽查审计。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 数据仓库中包含大量 PII 字段，如身份证、手机号、家庭住址；
  2. 查询/导出接口未做字段过滤，直接输出所有列；
  3. 下游服务调用不加权限控制获取敏感数据表信息；

- **已有措施**：

  1. 敏感字段脱敏处理（部分使用掩码、加密）；
  2. 按角色划分查询权限（普通用户仅查看聚合信息）；
  3. 报表模板限制输出字段与下钻字段范围；

- **可行性分析**：

  1. 字段元数据系统中记录敏感字段标记；
  2. 查询接口层可识别字段类型，进行拦截或替换；
  3. 报表系统具备字段级授权配置功能；

- **建议消减措施**：

  1. 敏感字段访问需要二次认证或审批流程；
  2. 自动标识敏感字段在查询链路中进行遮盖或替换；
  3. 输出字段需经过白名单校验或接口响应字段自动扫描过滤。

- **风险等级**：高

**D - 拒绝服务**

- **影响描述**：

  1. 大量无条件查询导致 CPU、内存耗尽，影响其他用户使用；
  2. 复杂 SQL（如笛卡尔积）拖垮数仓计算节点；
  3. 导出接口被恶意刷调用，压垮导出服务队列；

- **已有措施**：

  1. 对外接口设有最大行数限制与分页机制；
  2. 调度任务设置最大执行时间，超时强制终止；
  3. 导出任务异步执行，按任务队列排队控制；

- **可行性分析**：

  1. 查询服务层接入限流 + 超时机制；
  2. 已部署 SQL 质量检测工具（如SQL审核器）；
  3. 调度平台支持任务类型限频与速率调度；

- **建议消减措施**：

  1. 针对高危 SQL 设置语法黑名单（禁止 JOIN \*、嵌套子查询等）；
  2. 查询请求加入风险评估打分，必要时拒绝或要求审批；
  3. 限制导出接口并行任务数 + 用户调用频率。

- **风险等级**：高

**E - 权限提升**

- **影响描述**：

  1. 普通用户访问管理员定义的内部表，读取详细数据；
  2. 通过参数篡改调用系统级视图，获得未授权数据源信息；
  3. 下游调用时未验证调用方身份，默认信任造成越权访问。

- **已有措施**：

  1. 查询接口与数据表绑定权限角色；
  2. 访问数据接口需携带权限令牌，由数据服务验证；
  3. 多租户环境已启用租户隔离方案（schema/库名隔离）；

- **可行性分析**：

  1. 数据权限中心维护用户与数据资源的绑定关系；
  2. 报表系统接入权限平台校验字段与数据级授权；
  3. 已可按部门/角色/数据域配置可见范围；

- **建议消减措施**：

  1. 所有数据查询必须验证数据访问令牌 + 租户范围；
  2. 数据权限策略支持资源 → 字段 → 行级多层组合判断；
  3. 每次访问返回字段含权限标识，供前端动态控制 UI 展示。

- **风险等级**：高

**P - 隐私侵犯**

- **影响描述**：

  1. 报表中包含真实姓名、身份证号、手机号等个人隐私信息；
  2. 数据导出未做脱敏处理，文件被下发或外泄；
  3. 数据使用无明确目的，导致敏感数据滥用。

- **已有措施**：

  1. 数据导出模块支持字段脱敏配置；
  2. 敏感字段使用掩码或加密存储；
  3. 报表系统支持字段级隐私标签与展示配置；

- **可行性分析**：

  1. 字段元数据系统支持敏感级别打标签；
  2. 报表系统支持敏感字段展示权限控制；
  3. 数据服务具备数据访问日志能力，可用于追溯与告警；

- **建议消减措施**：

  1. 所有导出字段进行敏感度评估，强制脱敏输出；
  2. 敏感字段默认不可展示，需用户申请权限；
  3. 接入隐私合规审查机制（支持中国网络安全法/个人信息保护法等）。

- **风险等级**：高

---

### 元素：Redis Cluster（Data Store）

**T - 数据篡改**

- **影响描述**：

  1. 攻击者通过接口或命令注入伪造缓存内容；
  2. 缓存值被污染，影响业务展示与判断逻辑；
  3. 热Key（如用户权限、验证码）被非法修改影响登录/鉴权。

- **已有措施**：

  1. Redis 接口只读权限，禁止写入敏感数据字段；
  2. 缓存内容通过逻辑校验字段格式与签名；
  3. 设置Key前缀与生命周期限制（如5分钟验证码）。

- **可行性分析**：

  1. Redis 实例部署在内网隔离环境中；
  2. 使用统一缓存服务访问，便于控制字段结构；
  3. 多数业务缓存逻辑已封装在SDK中集中管理。

- **建议消减措施**：

  1. 高敏感缓存内容添加签名或摘要字段校验；
  2. 对缓存命中率低的Key增加报警，防热Key污染；
  3. 定期扫描缓存结构与内容完整性校验。

- **风险等级**：中

**R - 抵赖**

- **影响描述**：

  1. 用户删除缓存后引发业务逻辑异常无法追溯；
  2. 接口操作缓存造成业务混乱用户否认行为；
  3. 无法定位某条缓存内容被篡改或刷新时间点。

- **已有措施**：

  1. 高风险缓存写入操作记录用户与调用链；
  2. 缓存更新记录关键Key操作日志与来源；
  3. 数据写入使用带版本信息格式或加时间戳。

- **可行性分析**：

  1. SDK支持操作行为日志落盘；
  2. 可接入中间件打印缓存命中、更新行为；
  3. Redis操作集中封装，有统一日志打印能力。

- **建议消减措施**：

  1. 高价值缓存操作加入用户身份与上下文记录；
  2. 缓存修改操作增加审计日志并分类管理；
  3. 开启定时对热Key更新频率与用户行为对账。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 缓存中包含用户手机号、身份证号、SessionToken等明文数据；
  2. 日志记录缓存内容输出未脱敏；
  3. 管理员或开发通过工具连接Redis误读私密内容。

- **已有措施**：

  1. 敏感字段加密存储到缓存，如AES加密手机号；
  2. 缓存Key结构做命名隔离（如cache\:user\:secure:\*）；
  3. 日志中字段加掩码处理避免输出明文。

- **可行性分析**：

  1. Redis接口封装统一由内部SDK调用；
  2. 应用支持字段级脱敏处理逻辑可统一调用；
  3. 加密模块已有密钥管理方案便于集成。

- **建议消减措施**：

  1. 敏感字段缓存全部加密或摘要脱敏；
  2. Redis客户端访问配置默认禁止访问敏感Key前缀；
  3. 对敏感缓存访问行为做行为预警和审计记录。

- **风险等级**：高

**D - 拒绝服务**

- **影响描述**：

  1. 高并发热点缓存查询导致Redis连接数耗尽；
  2. 缓存雪崩后导致底层数据库请求激增崩溃；
  3. 缓存击穿（单点查询高频）造成线程阻塞。

- **已有措施**：

  1. 设置缓存过期随机时间防止集中过期；
  2. 热点缓存加互斥锁或预热机制避免击穿；
  3. 限制同一接口缓存失效后最大重构线程数。

- **可行性分析**：

  1. 微服务框架支持缓存组件（如 Spring Cache / Caffeine）；
  2. 已封装重建缓存逻辑并限流保护；
  3. Redis连接池具备连接数配置与告警能力。

- **建议消减措施**：

  1. 热Key请求加入预估请求量指标控制下游；
  2. 所有查询缓存加请求降级机制（如返回默认值）；
  3. 缓存重建失败时强制熔断避免进一步请求。

- **风险等级**：高

**E - 权限提升**

- **影响描述**：

  1. 普通用户构造缓存Key读取不属于自己的缓存数据；
  2. 管理后台写入任意缓存Key造成逻辑注入；
  3. 缓存结构混乱导致权限逻辑被绕过。

- **已有措施**：

  1. 缓存Key拼接中包含用户ID/租户ID字段做隔离；
  2. 缓存服务对外暴露接口加权限注解限制；
  3. 高权限Key前缀单独设置独立读写接口。

- **可行性分析**：

  1. 微服务均统一通过SDK封装缓存访问操作；
  2. Key命名规范统一并已按模块/业务隔离；
  3. 权限校验支持拦截器方式扩展在接口层。

- **建议消减措施**：

  1. 所有缓存读写接口强制校验用户上下文（ID/权限域）；
  2. 高权限缓存Key注册到权限平台集中管理；
  3. 对不合法Key访问行为记录并拦截告警。

- **风险等级**：中

**P - 隐私侵犯**

- **影响描述**：

  1. Redis中缓存了大量用户敏感信息未加密；
  2. 日志记录输出缓存内容包含隐私字段；
  3. 缓存工具连接查看生产环境Key时暴露敏感内容。

- **已有措施**：

  1. 高敏感字段（如手机号、身份证）加密后缓存；
  2. 缓存中加字段脱敏工具，日志中使用掩码打印；
  3. 禁止生产Redis使用通用客户端直接访问。

- **可行性分析**：

  1. 使用缓存服务封装中已具备加密处理能力；
  2. 日志服务支持过滤掩码字段插件；
  3. 生产环境Redis端口隔离，无公网暴露。

- **建议消减措施**：

  1. 敏感字段默认缓存加密，加密Key轮换机制；
  2. 日志记录前对所有敏感字段加统一脱敏处理；
  3. 对缓存内容自动识别字段分类并加密/脱敏存储。

- **风险等级**：高

---

### 元素：Config Center（Data Store）

**T - 数据篡改**

- **影响描述**：

  1. 恶意用户或误操作修改配置导致服务异常甚至不可用；
  2. 敏感配置（如白名单开关）被关闭绕过安全防护；
  3. 被攻击者批量推送配置修改使服务执行逻辑被劫持。

- **已有措施**：

  1. 配置中心支持版本回滚和变更历史追踪；
  2. 敏感配置项设有审批机制；
  3. 配置修改仅开放给授权角色用户执行。

- **可行性分析**：

  1. 当前使用中心化配置平台（如 Nacos、Apollo）；
  2. 配置中心已有审计日志和版本对比功能；
  3. 支持灰度发布与单机/分组推送限制。

- **建议消减措施**：

  1. 关键配置项（如认证、限流、脱敏）需启用二次审批；
  2. 配置变更加入自动快照和部署前校验机制；
  3. 引入配置发布“冻结机制”，避免误推生产环境。

- **风险等级**：高

**R - 抵赖**

- **影响描述**：

  1. 用户修改配置后造成业务故障但否认操作；
  2. 审计日志缺失导致无法还原某次配置回滚原因；
  3. 配置值修改频繁无变化记录无法分析趋势。

- **已有措施**：

  1. 配置中心记录操作人、时间、变更内容日志；
  2. 每次发布均生成版本号用于回退；
  3. 管理后台可查询历史配置及操作记录。

- **可行性分析**：

  1. 接口与UI层均支持变更日志联动；
  2. 审计日志已接入日志平台集中存储；
  3. 所有配置项变更已开启强制记录开关。

- **建议消减措施**：

  1. 日志内容结构化，记录前后差异值 +摘要对比；
  2. 操作记录与企业IM、审批系统对接，形成完整责任链；
  3. 定期发送变更审计报告供安全/架构复核。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 配置中心中包含数据库密码、Token、密钥等敏感信息明文存储；
  2. 访问配置接口返回全量配置项暴露内部系统结构；
  3. 日志或浏览器控制台中打印出配置值原文。

- **已有措施**：

  1. 敏感字段加密存储（如 AES），前端仅显示密文或占位符；
  2. 配置接口权限隔离（普通用户无权读取敏感项）；
  3. 输出层移除配置内容中的密钥、密码等敏感段；

- **可行性分析**：

  1. 加解密插件支持字段级加密展示；
  2. 权限模型支持资源级访问控制；
  3. 接口返回值经过统一拦截器处理支持字段移除。

- **建议消减措施**：

  1. 敏感配置字段加密存储 + 强制脱敏输出（不允许原文显示）；
  2. 所有配置项按是否为“公开配置”做标签划分；
  3. 导出功能需自动剔除敏感配置项。

- **风险等级**：高

**D - 拒绝服务**

- **影响描述**：

  1. 配置中心高并发拉取导致服务资源耗尽；
  2. 集中修改导致短时间大规模应用实例重启；
  3. 恶意轮询接口拉取配置内容导致后台崩溃。

- **已有措施**：

  1. 拉取频率限制、开启缓存机制降低配置下发频率；
  2. 配置修改异步广播 + 限流机制；
  3. 实例拉取配置支持本地缓存兜底机制。

- **可行性分析**：

  1. 配置中心平台具备限流插件可动态调整策略；
  2. 支持灰度发布、灰度推送、分批重启能力；
  3. 配置同步机制支持应用层本地缓存优先级策略。

- **建议消减措施**：

  1. 对于低变动配置使用文件同步方式缓存落盘；
  2. 对配置广播使用增量推送机制替代全量推送；
  3. 高并发拉取接口接入验证码/Token刷新保护。

- **风险等级**：中

**E - 权限提升**

- **影响描述**：

  1. 普通用户通过绕过鉴权 API 修改其他模块配置；
  2. 拥有读权限用户可通过日志/接口窥探非授权配置项；
  3. 配置文件修改带来权限提权（如开启调试模式、免密登录）。

- **已有措施**：

  1. 权限模型区分读/写/发布权限分离控制；
  2. 操作需绑定对应角色或租户授权；
  3. 操作界面与接口统一做权限认证。

- **可行性分析**：

  1. 接口与用户角色绑定已实现接口级鉴权；
  2. 配置项支持按项目、环境、模块维度划分权限域；
  3. 日志支持记录每次请求携带的角色/租户信息。

- **建议消减措施**：

  1. 接口调用需携带签名 + 权限Token校验机制；
  2. 用户权限变更加入审批机制，禁止自动继承父级权限；
  3. 接口权限支持精细到配置项ID级别。

- **风险等级**：高

**P - 隐私侵犯**

- **影响描述**：

  1. 配置项中包含用户行为、接口日志路径、埋点开关等；
  2. 将隐私内容通过配置开放未加权限限制；
  3. 多租户共享配置导致租户 A 看到租户 B 的数据行为开关。

- **已有措施**：

  1. 配置项按租户隔离，使用前缀或 namespace 区分；
  2. 敏感配置项默认加密 + 禁止导出；
  3. 配置页面根据用户角色动态显示字段内容。

- **可行性分析**：

  1. 多租户结构支持逻辑/物理隔离；
  2. 配置项已有敏感字段标记与分类机制；
  3. 操作记录与变更日志绑定操作人及可见范围。

- **建议消减措施**：

  1. 所有配置字段建立可见性矩阵 + 隐私等级分类表；
  2. 敏感配置项操作需强制脱敏 + 告警审计；
  3. 配置项变更时触发数据保护评估流程。

- **风险等级**：高

---

### 元素：External User（外部用户 / External Interactor）

**S - 身份伪造（Spoofing）**

- **影响描述**：

  1. 攻击者冒充合法用户登录系统执行查询或下载；
  2. 模拟正常用户请求访问系统资源获取授权数据；
  3. 使用抓包工具伪造 Token 或 Session 发起请求。

- **已有措施**：

  1. 登录采用账号密码+验证码机制；
  2. 接口需附带有效 Token，后端统一验证签名；
  3. 开启登录失败次数锁定策略。

- **可行性分析**：

  1. 登录服务接入统一认证中心；
  2. Token 采用 JWT 带签名及过期时间；
  3. 多数接口调用均基于 Token 验证访问；

- **建议消减措施**：

  1. 引入 MFA（如短信验证码或TOTP）强化认证；
  2. Token 加入设备ID或地理位置做二次绑定校验；
  3. 异常登录行为（如异地、多终端）触发告警机制。

- **风险等级**：高

**R - 抵赖（Repudiation）**

- **影响描述**：

  1. 用户否认发起过敏感请求如导出、下载；
  2. 日志中无法有效确认请求者身份及上下文信息；
  3. 无行为链记录难以还原查询、操作路径。

- **已有措施**：

  1. 用户操作记录接入日志平台统一管理；
  2. 登录、查询、导出等行为打点日志自动上报；
  3. 通过接口参数和Token记录用户标识及行为轨迹。

- **可行性分析**：

  1. 已部署操作日志与审计平台（如 ELK）；
  2. 日志中包含时间戳、IP、设备信息、请求路径；
  3. 日志支持条件搜索，辅助回溯定位操作人。

- **建议消减措施**：

  1. 所有敏感行为（查询/导出）启用行为签名记录；
  2. 操作日志绑定用户真实身份与认证设备；
  3. 用户可在个人中心查看操作日志，提升可见性与可溯性。

- **风险等级**：中

**I - 信息泄露（Information Disclosure）**

- **影响描述**：

  1. 外部用户通过接口访问未授权数据字段（如手机号、金额等）；
  2. 报错信息中泄露系统结构、字段名、数据库错误栈；
  3. 用户通过枚举ID、参数调试等手段获取非本人的数据内容。

- **已有措施**：

  1. 接口按权限输出字段白名单（基于角色）；
  2. 统一错误响应拦截敏感堆栈信息不向前端透出；
  3. 报表与接口输出字段已打标签，默认脱敏输出。

- **可行性分析**：

  1. 接口响应格式固定便于字段拦截；
  2. 报表系统具备字段级权限配置；
  3. 统一异常处理器已落地于主要微服务。

- **建议消减措施**：

  1. 使用字段权限服务动态返回用户可访问字段集合；
  2. 所有字段进行隐私分类与级别标记，输出层自动脱敏；
  3. ID参数统一加密传输，防止暴力遍历与横向查询。

- **风险等级**：高

**P - 隐私侵犯（Privacy Violation）**

- **影响描述**：

  1. 用户查询结果中包含本人及他人敏感信息未加控制（如家庭住址）；
  2. 数据导出后内容未经脱敏处理可能外泄；
  3. 无法限制用户将数据用于二次加工与非法流转。

- **已有措施**：

  1. 报表导出自动替换敏感字段为掩码或通用字段；
  2. 查询权限已与字段/表进行绑定限制；
  3. 数据授权过程需审批并记录用途声明。

- **可行性分析**：

  1. 后端已配置字段敏感度与脱敏规则；
  2. 报表系统与接口支持按用户角色控制字段级显示；
  3. 用户行为可追踪，支持违规行为判责。

- **建议消减措施**：

  1. 敏感字段默认脱敏展示，需“查看原文”需额外授权或操作人认证；
  2. 数据导出需审批授权并强制加水印标识来源用户；
  3. 建立个人信息最小可用原则与数据访问合规评估机制。

- **风险等级**：高

---

### 元素：External API / 外部系统（External Interactor）

**T - 数据篡改**

- **影响描述**：

  1. 外部 API 返回结果被中间代理或拦截篡改，影响数据准确性；
  2. 外部系统伪造响应结构或字段，误导内部处理逻辑；
  3. 接口被伪造响应注入脚本数据（如XSS向量）。

- **已有措施**：

  1. API 请求和响应走 HTTPS 加密通道；
  2. 接入结果经过 JSON schema 验证；
  3. 外部返回结构采用白名单字段过滤；

- **可行性分析**：

  1. 与外部 API 通信统一通过后端服务封装调用；
  2. 网络路径上无中间透明代理，具备可信路径验证；
  3. 调用 SDK 支持自定义校验响应结构及内容安全策略。

- **建议消减措施**：

  1. 引入响应字段签名验证机制，保证完整性；
  2. 对第三方接口返回结构做冗余字段检测与剔除；
  3. 构建 API 结果缓存 + 回源一致性检查机制。

- **风险等级**：中

**R - 抵赖**

- **影响描述**：

  1. 第三方平台拒绝承认返回错误或篡改行为；
  2. 接口调用无日志记录，无法判定数据来源和责任归属；
  3. 系统数据污染难以溯源。

- **已有措施**：

  1. 所有 API 请求、响应日志记录接入审计平台；
  2. 外部调用加入 traceId 与接口请求流水号；
  3. 错误响应保存完整上下文（参数、Header）。

- **可行性分析**：

  1. 当前日志平台具备结构化外部API日志管理能力；
  2. 微服务框架中统一封装外部接口模块；
  3. 接口 SDK 支持接入调用 ID / 时间戳 / IP 等追踪字段。

- **建议消减措施**：

  1. 每次接口调用生成唯一签名串并写入日志，用于外部对账；
  2. 所有接口错误响应配置上报机制，供故障回放与归责；
  3. 关联查询日志/审计日志，明确上游系统责任归属。

- **风险等级**：中

**I - 信息泄露**

- **影响描述**：

  1. 第三方接口返回数据包含用户敏感信息（手机号、身份证、账户余额等）；
  2. 外部返回字段中含 PII，但未做脱敏就透传至前端；
  3. 接口返回过多冗余字段，造成内部结构泄漏。

- **已有措施**：

  1. 返回数据字段层面配置白名单；
  2. 网关统一处理第三方响应做字段脱敏；
  3. 敏感信息输出加入敏感字段审查机制。

- **可行性分析**：

  1. 所有外部请求统一封装为 API Proxy 模块，支持中间转换；
  2. 响应结构支持自动扫描与敏感标记识别；
  3. 内部数据处理模块支持字段级别转译与掩码。

- **建议消减措施**：

  1. 对外部 API 响应字段做结构校验 + 敏感字段标记统一脱敏；
  2. 外部接口字段接入动态风险评分与字段自动告警机制；
  3. 开通字段透传检查工具，提前发现冗余字段或意外字段。

- **风险等级**：高

**D - 拒绝服务**

- **影响描述**：

  1. 外部接口响应过慢或超时阻塞业务主线程；
  2. 外部系统雪崩导致本系统调用失败连锁反应；
  3. 大量调用异常返回造成日志、异常堆积占满资源。

- **已有措施**：

  1. 接口调用配置超时时间与重试策略；
  2. 调用失败次数超过阈值熔断或降级处理；
  3. 接口调用使用线程池与队列缓冲处理超时风险。

- **可行性分析**：

  1. 框架中已接入熔断组件（如 Resilience4j / Sentinel）；
  2. 微服务容器支持线程资源隔离；
  3. 日志平台支持慢接口调用记录与统计分析。

- **建议消减措施**：

  1. 对所有第三方接口调用封装断路器逻辑；
  2. 外部接口异步处理或消息队列缓冲并降级回退逻辑；
  3. 自动识别接口异常频率，触发封锁/限频操作防级联风险。

- **风险等级**：中

**E - 权限提升**

- **影响描述**：

  1. 外部接口设计不当，调用者可访问未授权的数据范围；
  2. 外部系统未验证调用方身份，信任网段或Header被伪造；
  3. 系统未隔离访问作用域，导致数据越权访问（如共享Token）。

- **已有措施**：

  1. 外部 API 调用必须带签名与来源系统校验信息；
  2. 调用权限与数据权限由Token或 AppId 控制；
  3. 调用Token配置失效机制 +绑定来源 IP 限制；

- **可行性分析**：

  1. 网关支持接口调用来源识别；
  2. 已配置外部系统Token与权限列表管理功能；
  3. 接口侧支持自定义Header解析与系统身份识别机制。

- **建议消减措施**：

  1. 接口调用加入Scope/Resource限制字段进行权限隔离；
  2. 所有外部调用请求添加来源服务ID并校验白名单；
  3. 外部调用行为日志绑定应用与行为类型做粒度化审计。

- **风险等级**：高

**P - 隐私侵犯**

- **影响描述**：

  1. 调用第三方接口返回的用户数据被内部系统滥用或跨用途使用；
  2. 接口返回敏感信息无脱敏、无日志控制泄露给其他模块；
  3. 未告知用户情况下使用外部画像或行为标签数据。

- **已有措施**：

  1. 数据调用与使用场景绑定字段与审批记录；
  2. 外部接口响应数据字段强制脱敏；
  3. API调用过程记录使用目的与责任方。

- **可行性分析**：

  1. 审计系统已接入外部接口日志记录；
  2. 外部接口SDK支持字段级脱敏配置与拦截；
  3. 内部数据处理模块支持敏感字段标签化与级别控制。

- **建议消减措施**：

  1. 第三方接口返回字段按字段级目的分类+访问控制；
  2. 接口调用链需绑定使用意图与审计上下文；
  3. 用户画像与第三方行为数据使用场景建立审批制度与数据保护评估机制。

- **风险等级**：高

---

### 数据流：用户 ➜ 认证服务 ➜ 网关 ➜ 微服务 ➜ 数据源 / 外部 API

#### 数据流段 A：用户 ➜ 认证服务

**S - 身份伪造**

- **影响描述**：

  1. 攻击者伪造合法用户凭证进行登录；
  2. 中间人劫持并重放登录请求；
  3. 伪造Token冒充合法用户。

- **已有措施**：

  1. 登录接口启用验证码与限频机制；
  2. Token加签及短时效；
  3. 登录行为日志实时记录并分析。

- **可行性分析**：

  1. 认证服务支持多因子验证机制；
  2. 所有请求已走 HTTPS 加密；
  3. JWT签名算法与加密秘钥统一管理。

- **建议消减措施**：

  1. 增加设备指纹绑定与登录环境感知；
  2. 引入动态风险评分影响登录行为处置；
  3. 登录行为支持图谱关联分析拦截伪造身份。

- **风险等级**：高

#### 数据流段 B：认证服务 ➜ 网关 ➜ 微服务

**T - 数据篡改**

- **影响描述**：

  1. Token 被篡改后仍被服务接收；
  2. 请求Header中的权限字段被替换；
  3. 参数篡改影响路由分发或权限判断。

- **已有措施**：

  1. Token签名验证逻辑由网关统一处理；
  2. Header字段白名单校验与字段不可更改标记；
  3. 鉴权结果缓存及可重放检查机制。

- **可行性分析**：

  1. 网关支持接口验签中间件；
  2. Token结构封闭不可解构修改；
  3. 微服务统一通过解析后的安全上下文获取用户信息。

- **建议消减措施**：

  1. 所有关键Header字段加密或签名防篡改；
  2. 网关与微服务建立多点验签机制；
  3. 重放Token行为自动阻断并发起预警。

- **风险等级**：中

#### 数据流段 C：微服务 ➜ 数据库 / 数据仓库

**I - 信息泄露**

- **影响描述**：

  1. 查询请求直接返回明文敏感字段；
  2. 查询条件未校验越权导致其他租户数据被访问；
  3. SQL注入等手段可访问非目标字段或表。

- **已有措施**：

  1. 使用ORM并绑定参数防止注入；
  2. 查询时自动注入租户ID进行隔离；
  3. 字段级脱敏在响应层进行处理。

- **可行性分析**：

  1. ORM框架已统一标准化；
  2. 租户隔离策略已封装为拦截器；
  3. 字段元信息已有敏感字段标识。

- **建议消减措施**：

  1. 所有接口增加字段可见性定义与校验；
  2. 敏感字段默认掩码展示，后台审批后原文可查；
  3. 动态SQL构造自动扫描字段级风险。

- **风险等级**：高

#### 数据流段 D：微服务 ➜ 外部 API

**P - 隐私侵犯**

- **影响描述**：

  1. 外部接口响应中返回过量用户数据（含隐私字段）；
  2. 数据经微服务传至前端未进行脱敏或授权判断；
  3. 微服务未对外部API数据用途做合规性限制。

- **已有措施**：

  1. 外部接口结果使用DTO过滤字段；
  2. 敏感字段强制脱敏并日志记录；
  3. 接口调用行为与字段访问可审计。

- **可行性分析**：

  1. 外部API调用由统一模块封装；
  2. DTO结构明确字段级权限与敏感属性；
  3. 审计日志平台可记录调用人/调用字段/目标系统。

- **建议消减措施**：

  1. 外部API响应字段建立白名单机制，默认拒绝多余字段；
  2. 字段脱敏在接口层而非前端进行；
  3. 外部接口配置数据使用范围与用途并固化入日志。

- **风险等级**：高

---

# STRIDE+P 威胁建模风险矩阵（汇总表）

| 模块/元素                | S - 身份伪造 | T - 数据篡改 | R - 抵赖 | I - 信息泄露 | D - 拒绝服务 | E - 权限提升     | P - 隐私侵犯 |
| ------------------------ | ------------ | ------------ | -------- | ------------ | ------------ | ---------------- | ------------ |
| Authentication Service   | 高           | 高           | 中       | 中           | 高           | 高               | 中           |
| API Gateway              | 高           | 高           | 中       | 中           | 高           | 高               | 高           |
| Microservices            | 中           | 中           | 中       | 高           | 高           | 高（含横纵越权） | 高           |
| Data Warehouse           | 低           | 中           | 中       | 高           | 高           | 高               | 高           |
| Redis Cluster            | 低           | 中           | 中       | 高           | 高           | 中               | 高           |
| Config Center            | 低           | 高           | 中       | 高           | 中           | 高               | 高           |
| External User            | 高           | 低           | 中       | 高           | 低           | 高（越权行为）   | 高           |
| External API             | 中           | 中           | 中       | 高           | 中           | 高               | 高           |
| 数据流（用户至数据库等） | 高           | 中           | 中       | 高           | 中           | 高               | 高           |

---

### 数据流补充分析：外部用户 <--> API 网关；微服务 ➜ 外部 API；微服务 ➜ 应用配置中心

#### 数据流段 A：外部用户 <--> API 网关

**T - 数据篡改**

- **影响描述**：

  1. 攻击者伪造Header或参数篡改目标资源ID（如 TID）访问他人资源；
  2. 使用代理工具修改请求体，构造未授权行为；
  3. 重放修改后的有效请求执行多次非法操作。

- **已有措施**：

  1. Header与参数进行白名单校验；
  2. TID 和用户上下文绑定校验机制；
  3. 请求Body与TID一致性检查。

- **建议消减措施**：

  1. TID参数加签验签，防止伪造；
  2. 对关键参数做字段签名并校验来源；
  3. 重放请求识别并自动丢弃（基于Nonce+时间戳）。

**I - 信息泄露**

- **影响描述**：

  1. 网关错误响应返回完整堆栈或调试信息暴露服务结构；
  2. 外部用户请求时携带无效或越权TID，网关未拦截；
  3. 参数错误回显中泄露内部ID映射逻辑或结构。

- **建议消减措施**：

  1. 错误响应统一模糊处理，隐藏具体调用路径；
  2. TID校验失败返回统一异常码，避免暴露数据边界；
  3. 增加网关层TID访问日志与异常行为告警。

**E - 权限提升**

- **影响描述**：

  1. 外部用户通过TID伪造访问他人租户数据；
  2. API网关未进行TID与Token匹配校验；
  3. 通过参数拼接尝试访问高权限接口。

- **建议消减措施**：

  1. 所有TID参数与Token中的租户信息做一致性比对；
  2. 所有接口按TID维度配置权限控制；
  3. 多租户网关行为接入行为模型判断异常调用。

#### 数据流段 B：微服务 ➜ 外部 API

**T - 数据篡改**

- **影响描述**：

  1. 外部响应被篡改影响内部处理逻辑；
  2. 参数中包含TID或UID等字段被篡改造成结果错误。

- **建议消减措施**：

  1. 外部接口响应结构签名验签；
  2. 外部传入TID字段在微服务端校验是否属于授权租户。

**I - 信息泄露**

- **影响描述**：

  1. 响应中透传了外部接口完整返回（含敏感字段）；
  2. 外部接口中带有TID/UID/金额字段被误暴露到前端；
  3. 内部日志打印外部响应未脱敏。

- **建议消减措施**：

  1. 外部响应字段清洗+字段白名单；
  2. 日志中外部数据自动脱敏关键字段（如TID）。

**P - 隐私侵犯**

- **影响描述**：

  1. 响应中带有用户画像、行为标签等隐私内容；
  2. 响应内容未经脱敏直接输出前端；
  3. 外部数据与内部TID关联后形成强识别路径。

- **建议消减措施**：

  1. 外部数据落库前脱敏处理；
  2. 字段与TID、UID等关联行为加审计记录。

#### 数据流段 C：微服务 ➜ 应用配置中心

**T - 数据篡改**

- **影响描述**：

  1. 微服务拉取配置被代理劫持返回错误配置内容；
  2. 参数或Header被注入伪造TID上下文获取他人配置。

- **建议消减措施**：

  1. 拉取配置请求启用双向认证（SSL/Token）；
  2. TID限定租户作用域内的配置路径。

**R - 抵赖**

- **影响描述**：

  1. 微服务使用了错误配置但无法还原访问记录；
  2. 未记录TID与微服务配置访问路径。

- **建议消减措施**：

  1. 拉取配置操作需记录TID与服务调用标识；
  2. 每次配置访问写入审计日志，包括配置项名 + 版本。

**I - 信息泄露**

- **影响描述**：

  1. 拉取配置接口返回中包含敏感字段（如外部Token、加密Key）；
  2. 配置中心返回内容未做字段控制，根据TID访问越权配置项。

- **建议消减措施**：

  1. 每个配置项标记是否可暴露 + 是否租户隔离；
  2. 拉取配置内容做字段审计并加签返回。

---

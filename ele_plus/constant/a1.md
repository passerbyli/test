@startuml
actor User
participant Frontend
participant Gateway
participant QueryService
participant AuthService
participant PermissionService
database Database

User -> Frontend: 点击“查询订单”
Frontend -> Gateway: 请求 /query/orders (携带 token)

Gateway -> QueryService: 转发请求（token + 查询条件）

QueryService -> AuthService: 校验 token
AuthService --> QueryService: 返回 userInfo（userId、角色）

QueryService -> PermissionService: 获取数据权限(userId)
PermissionService --> QueryService: 返回权限规则（组织范围、字段级）

QueryService -> QueryService: 拼装 SQL + 应用权限规则
QueryService -> Database: 执行查询
Database --> QueryService: 返回订单数据

QueryService --> Gateway: 返回格式化后的报表数据
Gateway --> Frontend: 返回数据
Frontend -> User: 展示表格/图表

@enduml
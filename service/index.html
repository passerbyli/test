<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒé¡µé¢ Â· Simple Regex Tester</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1023; --muted:#94a3b8; --text:#e2e8f0; --accent:#60a5fa; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
      --border:#1e293b; --chip:#111827; --hl:#fde68a; --code:#0b1220; --card:#0f1a33;
    }
    html,body{height:100%;}
    body{margin:0;background:linear-gradient(180deg,#0b1023, #0a0f20 60%, #0b1220); color:var(--text);font:14px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    h1{font-size:22px;margin:0 0 8px;letter-spacing:.2px}
    .sub{color:var(--muted);margin-bottom:18px}
    .grid{display:grid;gap:12px;grid-template-columns:1fr;}
    @media(min-width:980px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:linear-gradient(180deg,#0e1530,#0b1226);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);}
    .card-hd{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--border)}
    .card-bd{padding:14px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    label{color:var(--muted)}
    input[type=text],textarea{width:100%;padding:10px 12px;background:#0a0f1e;color:var(--text);border:1px solid var(--border);border-radius:10px;outline:none}
    input[type=text]:focus,textarea:focus{border-color:#334155;box-shadow:0 0 0 2px rgba(100,116,139,.25)}
    textarea{min-height:200px;resize:vertical}
    .btn{cursor:pointer;border:1px solid var(--border);background:linear-gradient(180deg,#0e172e,#0a1226);color:var(--text);padding:9px 14px;border-radius:10px}
    .btn:hover{border-color:#334155}
    .btn-ghost{background:#0a0f1e}
    .btn-ok{border-color:#14532d;background:linear-gradient(180deg,#0a1f16,#0e2b1c)}
    .btn-warn{border-color:#7c2d12;background:linear-gradient(180deg,#25150a,#2c180a)}
    .btn-acc{border-color:#1e3a8a;background:linear-gradient(180deg,#0b1634,#0e1a3f)}
    .chip{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;background:#0c1326;border:1px solid var(--border);color:var(--muted);font-size:12px}
    .muted{color:var(--muted)}
    .status{display:flex;gap:10px;flex-wrap:wrap}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .pre{background:var(--code);border:1px solid var(--border);padding:10px;border-radius:10px;overflow:auto}
    .hl{background:var(--hl);color:#111827;border-radius:4px;padding:0 2px}
    .preview{white-space:pre-wrap;word-break:break-word}
    .kbd{font:12px ui-monospace,monospace;background:#0b1020;border:1px solid var(--border);padding:1px 6px;border-radius:6px;color:var(--muted)}
    .cols{display:grid;gap:10px;grid-template-columns:1fr}
    @media(min-width:720px){.cols{grid-template-columns:1fr 1fr}}
    .flags{display:flex;flex-wrap:wrap;gap:8px}
    .flag input{display:none}
    .flag label{user-select:none;cursor:pointer}
    .flag .chip{border-color:#1f2937}
    .flag input:checked + label .chip{border-color:#1e3a8a;color:#c7d2fe;background:#0b1534}
    .list{display:grid;gap:6px}
    .match{padding:8px;border:1px dashed #334155;border-radius:10px}
    .help small{color:var(--muted)}
    .presets{gap:8px;display:flex;flex-wrap:wrap}
    .presets button{font-size:12px}
    .footer{opacity:.7;margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ§ª æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ Â· Simple Regex Tester</h1>
    <div class="sub">è¾“å…¥ <span class="mono">pattern</span> ä¸ <span class="mono">flags</span>ï¼Œåœ¨å³ä¾§æŸ¥çœ‹åŒ¹é…ç»“æœä¸é«˜äº®ã€‚æ”¯æŒæœ¬åœ°ä¿å­˜ã€é¢„è®¾ç¤ºä¾‹ä¸æ›¿æ¢æµ‹è¯•ã€‚</div>

    <div class="grid">
      <!-- å·¦ï¼šè¾“å…¥åŒº -->
      <section class="card">
        <div class="card-hd">
          <strong>è¾“å…¥</strong>
          <span class="chip">å¿«æ·é”®ï¼š<span class="kbd">Cmd/Ctrl</span> + <span class="kbd">Enter</span> è¿è¡Œ</span>
        </div>
        <div class="card-bd">
          <div class="row">
            <div style="flex:1 1 auto">
              <label>æ­£åˆ™ Pattern</label>
              <input id="pattern" type="text" placeholder="ä¾‹å¦‚ï¼š^\n?\s*hello" />
            </div>
            <div style="flex:0 0 auto;min-width:220px">
              <label>Flags</label>
              <div class="flags" id="flagsBox"></div>
            </div>
          </div>

          <div class="row" style="margin-top:8px">
            <div style="flex:1 1 auto">
              <label>æµ‹è¯•æ–‡æœ¬</label>
              <textarea id="text" placeholder="å°†å¾…åŒ¹é…å†…å®¹ç²˜è´´åˆ°è¿™é‡Œâ€¦â€¦"></textarea>
            </div>
          </div>

          <details style="margin-top:6px">
            <summary class="muted">å±•å¼€æ›¿æ¢æµ‹è¯•ï¼ˆå¯é€‰ï¼‰</summary>
            <div class="cols" style="margin-top:8px">
              <div>
                <label>æ›¿æ¢æ¨¡æ¿ï¼ˆæ”¯æŒ $&, $1..$9 ç­‰ï¼‰</label>
                <input id="replaceTpl" type="text" placeholder="ä¾‹å¦‚ï¼š<$&> æˆ– [$1]"/>
              </div>
              <div>
                <label>æ›¿æ¢ç»“æœï¼ˆåªè¯»ï¼‰</label>
                <textarea id="replaceOut" readonly></textarea>
              </div>
            </div>
          </details>

          <div class="row" style="margin-top:12px">
            <button id="run" class="btn btn-acc">è¿è¡ŒåŒ¹é…</button>
            <button id="clear" class="btn btn-ghost">æ¸…ç©º</button>
            <button id="save" class="btn">ä¿å­˜åˆ°æœ¬åœ°</button>
            <button id="load" class="btn">è¯»å–ä¸Šæ¬¡</button>
            <div class="presets" style="margin-left:auto">
              <button class="btn btn-ghost" data-preset="email">é‚®ç®±</button>
              <button class="btn btn-ghost" data-preset="url">URL</button>
              <button class="btn btn-ghost" data-preset="phone">æ‰‹æœºå·</button>
              <button class="btn btn-ghost" data-preset="ipv4">IPv4</button>
            </div>
          </div>
        </div>
      </section>

      <!-- å³ï¼šç»“æœåŒº -->
      <section class="card">
        <div class="card-hd">
          <strong>ç»“æœ</strong>
          <div class="status" id="status"></div>
        </div>
        <div class="card-bd">
          <div id="error" style="display:none;color:var(--err);margin-bottom:8px"></div>

          <div class="help" style="margin-bottom:8px">
            <small>Flag è¯´æ˜ï¼š<span class="mono">g</span> å…¨å±€ï¼Œ<span class="mono">i</span> å¿½ç•¥å¤§å°å†™ï¼Œ<span class="mono">m</span> å¤šè¡Œèµ·æ­¢ï¼Œ<span class="mono">s</span> ç‚¹å·åŒ¹é…æ¢è¡Œï¼Œ<span class="mono">u</span> Unicodeï¼Œ<span class="mono">y</span> ç²˜æ»åŒ¹é…ã€‚</small>
          </div>

          <div class="pre preview" id="preview">ï¼ˆé«˜äº®é¢„è§ˆåŒºåŸŸï¼‰</div>

          <h3 style="margin:12px 0 6px;font-size:14px;color:var(--muted)">åŒ¹é…åˆ—è¡¨</h3>
          <div class="list" id="list"></div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:12px">
      <div class="card-hd"><strong>å¿«é€Ÿæ•™ç¨‹</strong></div>
      <div class="card-bd">
        <ol style="margin:0;padding-left:18px">
          <li>åœ¨å·¦ä¾§è¾“å…¥ <span class="mono">pattern</span> ä¸å‹¾é€‰ <span class="mono">flags</span>ï¼Œç²˜è´´æµ‹è¯•æ–‡æœ¬ã€‚</li>
          <li>ç‚¹å‡»ã€Œè¿è¡ŒåŒ¹é…ã€æˆ–ç”¨ <span class="kbd">Cmd/Ctrl + Enter</span>ã€‚é”™è¯¯ä¼šæ˜¾ç¤ºåœ¨é¡¶éƒ¨çº¢å­—ã€‚</li>
          <li>ä¸‹æ–¹åˆ—è¡¨ä¼šæ˜¾ç¤ºæ¯ä¸ªåŒ¹é…çš„ <span class="mono">index</span>ã€<span class="mono">match</span> ä¸æ•è·ç»„ã€‚</li>
          <li>å±•å¼€ã€Œæ›¿æ¢æµ‹è¯•ã€å¯éªŒè¯ <span class="mono">String.prototype.replace</span> çš„æ›¿æ¢ç»“æœã€‚</li>
        </ol>
        <div class="footer">Made with â™¥. æœ¬é¡µé¢çº¯å‰ç«¯å®ç°ï¼Œå¯ç¦»çº¿ä¿å­˜ä¸º <span class="mono">.html</span> ç›´æ¥ä½¿ç”¨ã€‚</div>
      </div>
    </section>
  </div>

<script>
(function(){
  const patternEl = document.getElementById('pattern');
  const textEl = document.getElementById('text');
  const flagsBox = document.getElementById('flagsBox');
  const runBtn = document.getElementById('run');
  const clearBtn = document.getElementById('clear');
  const saveBtn = document.getElementById('save');
  const loadBtn = document.getElementById('load');
  const statusEl = document.getElementById('status');
  const previewEl = document.getElementById('preview');
  const listEl = document.getElementById('list');
  const errEl = document.getElementById('error');
  const replaceTplEl = document.getElementById('replaceTpl');
  const replaceOutEl = document.getElementById('replaceOut');

  const FLAG_ITEMS = [
    {k:'g', t:'å…¨å±€ (g)'},
    {k:'i', t:'å¿½ç•¥å¤§å°å†™ (i)'} ,
    {k:'m', t:'å¤šè¡Œ (m)'},
    {k:'s', t:'å•è¡Œ/ç‚¹ä»»æ„ (s)'},
    {k:'u', t:'Unicode (u)'},
    {k:'y', t:'ç²˜æ» (y)'}
  ];

  // æ¸²æŸ“ flags å¤é€‰
  FLAG_ITEMS.forEach(({k,t})=>{
    const id = 'flag_'+k
    const box = document.createElement('div');
    box.className = 'flag';
    box.innerHTML = `<input id="${id}" type="checkbox" value="${k}"><label for="${id}"><span class="chip">${k.toUpperCase()}</span></label>`
    flagsBox.appendChild(box)
  })

  function getFlags(){
    return FLAG_ITEMS.map(({k})=>document.getElementById('flag_'+k).checked? k : '').join('');
  }
  function setFlags(flags){
    FLAG_ITEMS.forEach(({k})=>{
      document.getElementById('flag_'+k).checked = flags.includes(k)
    })
  }

  function highlight(text, matches){
    if(!matches.length) return escapeHtml(text);
    const ranges = matches.map(m=>({start:m.index, end:m.index + m[0].length}))
    // åˆå¹¶é‡å åŒºé—´
    ranges.sort((a,b)=>a.start-b.start)
    const merged=[]; let cur=null
    for(const r of ranges){
      if(!cur || r.start>cur.end){ cur = {...r}; merged.push(cur) }
      else { cur.end = Math.max(cur.end, r.end) }
    }
    let out=''; let p=0
    for(const r of merged){
      out += escapeHtml(text.slice(p, r.start))
      out += '<span class="hl">' + escapeHtml(text.slice(r.start, r.end)) + '</span>'
      p = r.end
    }
    out += escapeHtml(text.slice(p))
    return out
  }

  function escapeHtml(str){
    return str.replace(/[&<>\"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]))
  }

  function run(){
    const pattern = patternEl.value
    const flags = getFlags()
    const txt = textEl.value
    listEl.innerHTML = ''
    errEl.style.display = 'none'
    errEl.textContent = ''
    replaceOutEl.value = ''

    if(!pattern){
      statusEl.innerHTML = `<span class="chip">æœªè¾“å…¥ Pattern</span>`
      previewEl.innerHTML = escapeHtml(txt||'')
      return
    }

    let re
    try{ re = new RegExp(pattern, flags) }
    catch(e){
      errEl.style.display = 'block'
      errEl.textContent = 'æ­£åˆ™è¯­æ³•é”™è¯¯ï¼š' + e.message
      statusEl.innerHTML = `<span class="chip">ç¼–è¯‘å¤±è´¥</span>`
      previewEl.innerHTML = escapeHtml(txt)
      return
    }

    const matches = []
    if(flags.includes('g')){
      let m
      while((m = re.exec(txt))){
        matches.push(m)
        if(m.index === re.lastIndex) re.lastIndex++ // é˜²æ­¢é›¶å®½æ­»å¾ªç¯
      }
    }else{
      const m = re.exec(txt)
      if(m) matches.push(m)
    }

    statusEl.innerHTML = `
      <span class="chip">åŒ¹é…æ•°ï¼š<b class="mono">${matches.length}</b></span>
      <span class="chip">Flagsï¼š<span class="mono">/${flags||'(none)'}</span></span>
    `

    // é¢„è§ˆé«˜äº®
    previewEl.innerHTML = highlight(txt, matches)

    // åˆ—è¡¨
    if(!matches.length){
      listEl.innerHTML = '<div class="muted">æ— åŒ¹é…</div>'
    }else{
      const frag = document.createDocumentFragment()
      matches.forEach((m, i)=>{
        const div = document.createElement('div')
        div.className = 'match'
        const groups = Array.from(m).map((g,gi)=>`$${gi}: <code class="mono">${escapeHtml(String(g))}</code>`).join('  ')
        div.innerHTML = `#${i+1} @index <b class="mono">${m.index}</b> Â· length <b class="mono">${m[0].length}</b><br/>${groups}`
        frag.appendChild(div)
      })
      listEl.appendChild(frag)
    }

    // æ›¿æ¢æµ‹è¯•
    if(replaceTplEl.value){
      try{ replaceOutEl.value = textEl.value.replace(re, replaceTplEl.value) }
      catch(e){ replaceOutEl.value = 'æ›¿æ¢é”™è¯¯ï¼š' + e.message }
    }
  }

  // äº‹ä»¶
  runBtn.addEventListener('click', run)
  ;['keyup','change'].forEach(evt=>{
    patternEl.addEventListener(evt, debounce(run, 300))
    textEl.addEventListener(evt, debounce(run, 300))
    replaceTplEl.addEventListener(evt, debounce(run, 300))
    flagsBox.addEventListener(evt, debounce(run, 0))
  })
  document.addEventListener('keydown', (e)=>{
    if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ run() }
  })

  clearBtn.addEventListener('click', ()=>{
    patternEl.value=''; textEl.value=''; replaceTplEl.value=''; replaceOutEl.value='';
    setFlags(''); run();
  })

  // æœ¬åœ°å­˜å–
  const KEY = 'regex-tester-v1'
  saveBtn.addEventListener('click', ()=>{
    const data = { pattern: patternEl.value, flags: getFlags(), text: textEl.value, repl: replaceTplEl.value }
    localStorage.setItem(KEY, JSON.stringify(data))
    toast('å·²ä¿å­˜åˆ°æœ¬åœ°')
  })
  loadBtn.addEventListener('click', ()=>{
    const raw = localStorage.getItem(KEY)
    if(!raw) return toast('æš‚æ— å¯è¯»å–çš„æ•°æ®')
    try{
      const {pattern, flags, text, repl} = JSON.parse(raw)
      patternEl.value = pattern||''
      setFlags(flags||'')
      textEl.value = text||''
      replaceTplEl.value = repl||''
      run()
      toast('å·²è¯»å–ä¸Šæ¬¡å†…å®¹')
    }catch{ toast('è¯»å–å¤±è´¥') }
  })

  // é¢„è®¾
  document.querySelectorAll('[data-preset]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const p = btn.getAttribute('data-preset')
      const pres = {
        email: { pat: '^[\\w.-]+@[\\w.-]+\\.[A-Za-z]{2,}$', flags:'i', txt:'hello@example.com\nfoo@bar-baz.cn\nnot-an-email@\n' },
        url:   { pat: '^(https?:\\/\\/)?([\\w.-]+)\\.([A-Za-z]{2,})(:[0-9]+)?(\\/\\S*)?$', flags:'i', txt:'https://example.com\nhttp://foo.bar:8080/home?q=1\njust-text' },
        phone: { pat: '^(?:\\+?86)?1[3-9]\\d{9}$', flags:'', txt:'13800138000\n+8613500000000\n123456' },
        ipv4:  { pat: '^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$', flags:'', txt:'192.168.0.1\n256.0.0.1' }
      }
      const d = pres[p]
      patternEl.value = d.pat
      setFlags(d.flags)
      textEl.value = d.txt
      replaceTplEl.value = ''
      run()
    })
  })

  function debounce(fn, wait){
    let t; return function(){ clearTimeout(t); t = setTimeout(()=>fn.apply(this, arguments), wait) }
  }
  function toast(msg){
    const el = document.createElement('div');
    el.textContent = msg
    el.style.cssText = 'position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#0c1326;border:1px solid #334155;padding:8px 12px;border-radius:10px;color:#cbd5e1;z-index:9999;box-shadow:0 6px 18px rgba(0,0,0,.35)';
    document.body.appendChild(el)
    setTimeout(()=>{ el.remove() }, 1400)
  }

  // åˆå§‹ç¤ºä¾‹
  patternEl.value = '(foo)\\s+(bar)'
  setFlags('gi')
  textEl.value = 'Foo   bar\nfoo\tbar\nother line\nfoobar'
  run()
})()

/**
åŒ¹é…ç½‘å€
[a-zA-Z][a-zA-Z0-9+.-]*:\/\/[^\s"'<>]+


error:  (?:[a-zA-Z][a-zA-Z0-9+.-]*:\/\/)?(?:[a-zA-Z0-9-]+\.)*test\.com(?:\:\d+)?(?:\/[^\s"'<>]*)?
success:(?:[a-zA-Z][a-zA-Z0-9+.-]*:\/\/)?(?:[a-zA-Z0-9-]+\.)*test\.com(?::\d+)?(?:\/[^\s"'<>]*)?

error:    (?i)^\s*(?:(?:"?(?:token|key|secret|password)"?\s*[:=]\s*(['"]?)[A-Za-z0-9+/=_-]{8,}\1\s*[;,]?\s*$)|(?:[\w.-]*(?:token|key|secret|password)\b\s*=\s*(['"]?)[^\s#'"]+\2\s*(?:#.*)?$))
success:  ^\s*(?:"?(?:token|key|secret|password)"?\s*[:=]\s*(?:(?<q1>['"])[A-Za-z0-9+/=_-]{8,}\k<q1>|[A-Za-z0-9+/=_-]{8,})\s*[;,]?\s*$|[\w.-]*(?:token|key|secret|password)\b\s*=\s*(?:(?<q2>['"])[^\s#'"]+\k<q2>|[^\s#'"]+)\s*(?:#.*)?$)
**/
</script>
</body>
</html>
